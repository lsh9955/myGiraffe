# 1. ì‘ì—… í™˜ê²½ ì •í•˜ê¸°

## 0. íŒŒì´ì¬ ë°±ì—”ë“œëŠ” ì–´ë–»ê²Œ êµ¬ì¶•í•  ê²ƒì¸ê°€?

![Untitled](Untitled%2014.png)

> Django VS Flask vs JS?????
> 

<aside>
ğŸ’¡  ê°ê°ì˜ ëª¨ë¸ì˜ ì¥ë‹¨ì ì´ ë‹¤ë¥´ë‚˜, í˜„ì¬ë¡œì„œëŠ”
ğŸ”µ Flask: ê°€ë³ê³  ë‹¤ë£¨ê¸° ì‰¬ì›€. MicroServiceë¥¼ êµ¬ì¶•í•˜ëŠ”ë° ì‹œì‘í•˜ê¸° ì¢‹ìŒ
ğŸ”´ Django: ë‹¤ì–‘í•œ ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥. í•œë²ˆ êµ¬ì¡°í™” í•´ë†“ìœ¼ë©´ ì¼ì • ìˆ˜ì¤€ê¹Œì§€ í™•ì¥í•˜ê¸° ì¢‹ìŒ

</aside>

- â˜‘ï¸ Flask: ìƒˆë¡œìš´ ê¸°ìˆ  ìŠ¤íƒì´ì, API í†µì‹ ë§Œì„ í•„ìš”ë¡œ í•˜ëŠ” ML ì„œë²„ë¥¼ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ
- â Django: ì´í›„ ë°±ì—”ë“œì™€ MLì„ í†µí•©í•˜ì—¬ í•œê°€ì§€ ì–¸ì–´ë¡œ êµ¬ì¶•í•˜ë ¤ë©´ ì‚¬ìš©í•˜ê²Œ ë  ì˜ˆì •

### ê²°ë¡ 

> Flask
> 
- ML ì„œë²„ë¥¼ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤í™” í•˜ì—¬ ê¸°ëŠ¥ë³„ë¡œ ë¶„ì ˆí•˜ê²Œ ë  ê²ƒì´ê¸°ì—,
ê°€ë³ê³  ë¶„ì ˆí•˜ê¸° ì‰¬ìš´ Flaskë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•¨

## 1.  ë¶„ì„ íˆ´ì€ ë¬´ì—‡ì„ ì“¸ ê²ƒì¸ê°€?

> Pytorch  vs  Tensorflow 2.0 + Keras
> 

<aside>
ğŸ’¡  ê°ê°ì˜ ëª¨ë¸ì˜ ì¥ë‹¨ì ì´ ë‹¤ë¥´ë‚˜, í˜„ì¬ë¡œì„œëŠ”
ğŸ”µ CNN ê¸°ë°˜ í•„ê¸° ë¶„ì„ ëª¨ë¸: Keras
ğŸ”µ Web detection ê¸°ë°˜ íƒœê¹… ë¶„ì„: pytorch + Google Cloud Platform API í™œìš©
ğŸ”µ  CNN ê¸°ë°˜ ë‚™ì„œ ë¶„ë¥˜ ëª¨ë¸: Tensorflow

</aside>

- â˜‘ï¸ Pytorch: ì¥ê¸°ì ìœ¼ë¡œ ì¶”êµ¬í•˜ëŠ” ë°©ì‹ (í•˜ì§€ë§Œ í˜„ì¬ëŠ” ì•„ë‹˜)
- âœ… Tensorflow: ë‚™ì„œ ë¶„ë¥˜ ëª¨ë¸ê³¼ ì‚¬ìš©ìì˜ ì†ê°€ë½ ì¸ì‹ ëª¨ë¸
- âœ… Keras: CNN ê¸°ë°˜ ê°€ë²¼ìš´ ë¶„ë¥˜ ëª¨ë¸ì— í™œìš©
- â : ì´í›„ Keras, tensor ëª¨ë¸ì„ í†µí•©í•  ì˜ˆì •

### ê²°ë¡ 

> ê°ê°ì„ ë³‘í–‰í•˜ë©´ì„œ í†µí•©í•  ì˜ˆì •
> 
- ML ì„œë²„ë¥¼ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤í™” í•˜ì—¬ ê¸°ëŠ¥ë³„ë¡œ ë¶„ì ˆí•˜ê²Œ ëœë‹¤ë©´,
ê°ê°ì˜ ê¸°ëŠ¥ë“¤ì´ ë‹¤ë¥¸ íˆ´ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤ê³  í•˜ë”ë¼ë„ í¬ê²Œ ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.

## 2. Micro Service êµ¬ì¶• ë°©ì‹

> BluePrint? Micro Service?
> 

<aside>
ğŸ’¡ ì´ˆê¸°ì—ëŠ” BluePrintë¡œ ê¸°ëŠ¥ì„ ë¶„ì ˆí•˜ì—¬ ê´€ë¦¬í•˜ì˜€ìœ¼ë‚˜, ì´í›„ MicroServiceë¡œ ë¶„ì ˆ
ğŸ”µ Microservice: ë¶„ì‚° êµ¬ì¡° êµ¬ì¶• ê°€ëŠ¥
ğŸ”´ Blueprint: í•œë²ˆ êµ¬ì¡°ë¥¼ ì§œë†“ìœ¼ë©´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìš©ì´í•¨

</aside>

### 1. Blueprint?

> [app.py](http://app.py) í•˜ë‚˜ë¡œë„ êµ¬í˜„ë˜ëŠ” í”Œë¼ìŠ¤í¬ í™˜ê²½ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë¶„ì ˆí•´ì£¼ëŠ” ê¸°ëŠ¥
> 
1. [app.py](http://app.py) êµ¬ì„±í•˜ê¸°

```python
# app.py
from flask import Flask
from flask import Blueprint
from flaskblueprint import app_blueprint

# Blueprint ëª¨ë“ˆì„ ë“±ë¡í•©ë‹ˆë‹¤.
for blueprint in app_blueprint:
    app.register_blueprint(blueprint)
```

1. blueprintë¥¼ ëª¨ë“ˆí™” í•˜ê¸°
    
    ![Untitled](Untitled%2015.png)
    
    - `__**init__.py**`
        
        ```python
        # flaskblueprints/__init__.py
        # Flaskì— ì‚¬ìš©ë˜ëŠ” Blue prints ë“¤ì„ ëª¨ì•„ì„œ íŒ¨í‚¤ì§• í•´ì¤„ init.py ì…ë‹ˆë‹¤.
        from .aivoice_blueprint import aivoice_blueprint
        from .classifier_blueprint import classifier_blueprint
        from .numbers_blueprint import numbers_blueprint
        from .visionapi_blueprint import visionapi_blueprint
        
        # Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  Blueprint ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        app_blueprint = [
            aivoice_blueprint,
            classifier_blueprint,
            numbers_blueprint,
            visionapi_blueprint,
        ]
        ```
        
    - ê° ì„œë¹„ìŠ¤.py
        
        ```python
        # classifier_blueprint.py
        from keras.models import load_model
        from PIL import Image, ImageOps
        import numpy as np
        import io
        from flask import Blueprint, request, Response
        import base64
        import json
        
        **classifier_blueprint = Blueprint('classifier', __name__, url_prefix='/api')**
        
        # Disable scientific notation for clarity
        np.set_printoptions(suppress=True)
        
        # ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
        model = load_model("models/keras_model.h5", compile=False)
        
        # ëª¨ë¸ì„ í•™ìŠµ ì‹œí‚¬ ë•Œ ë„£ì—ˆë˜ ë°ì´í„° ë¼ë²¨ ë¶ˆëŸ¬ì˜¤ê¸° (ì´ê±° ìˆ˜ì •í•˜ë©´ ë¼ë²¨ì´ ë°”ë€ë‹ˆë‹¤)
        class_names = open("models/labels.txt", "r", encoding="utf-8").readlines()
        
        # Kerasì— ë§ì¶”ê¸° ìœ„í•´ì„œ depthë¥¼ ê°€ì§„ array í˜•ì‹ìœ¼ë¡œ ì§œì¤ë‹ˆë‹¤.
        data = np.ndarray(shape=(1, 224, 224, 3), dtype=np.float32)
        
        **@classifier_blueprint.route('/classifier', methods=['GET', 'POST'])**
        def classifier():
            # GET ìš”ì²­ ë“¤ì–´ì˜¤ë©´ 400 ìœ¼ë¡œ ë°˜í™˜ í•´ì£¼ê¸°
            if request.method == 'GET':
                datas = {'label': 'null',
                         'msg': 'Base64ë¡œ ì¸ì½”ë”©ëœ ë‚™ì„œ ë°ì´í„°ë¥¼ POST í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.'}
                json_data = json.dumps(datas)
                response = Response(json_data, status=400, mimetype='application/json')
                return response
            print("=====POST Done=====")
        
            # ë“¤ì–´ì˜¨ Base64 ì½”ë“œë¥¼ ì˜ë¼ì„œ ë°˜ì˜ í•´ì£¼ê¸°
            image_data = base64.b64decode(request.json['base64_drawing'][22:])
        
            # ë°°ê²½ì„ í•˜ì–€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì£¼ê¸°. ê·¸ëƒ¥ RGBë¡œ ë°”ê¿”ë²„ë¦¬ë©´ ê²€ì •ìƒ‰ìœ¼ë¡œ ë°”ë€œ.
            # image = Image.open(io.BytesIO(image_data)).convert('RGB')
            image_rgba = Image.open(io.BytesIO(image_data)).convert('RGBA')
            image_rgb = Image.new("RGB", image_rgba.size, (255, 255, 255))
            image_rgb.paste(image_rgba, mask=image_rgba.split()[3])
            image = image_rgb
        ```